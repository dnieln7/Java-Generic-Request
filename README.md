# Java Generic Request

_Java Library to make Http requests like GET, GET (ById), POST, PUT, DELETE, and cast the response into a desired type._

## Getting started

### Building a session

Sessions can be built with Builder class. The session will be pre configured with the following properties.

* Request Method: GET
* Expected response code: 200
* Do Output: false 
* Content-Type and Accept headers: application/json

````
GenericRequestSession.Builder builder = new GenericRequestSession.Builder("https://example.com/resources");
````

There can be some problems in the session building process son you need to surround it with try/catch.

````
try {
    GenericRequestSession session = builder.build();
} catch (BuilderException e) {
    // Handle errors
}
````

### Customizing session

You can change the session properties with the Builder setter methods.

````
builder.to("https://example.com/backups")   // Change destination URL
.withMethod(RequestMethod.POST)             // Change request method
.withOutput(true)                           // Set do output to true
.withResponseCode(201);                     // Change expected response code
````

#### Request properties (Headers)

To change the request properties you need to supply a map containing the new properties, these new properties will override the default ones.

````
Map<String, String> backupProperties = Map.of(
        "Content-Type", "application/json",
        "Accept", "application/json",
        "Authorization", "Bearer ".concat(token)
);

builder.withRequestProperties(backupProperties); // Change request properties
````

### Sending a request

#### GET request

1. Built a session with Builder class.

````
GenericRequestSession.Builder builder = new GenericRequestSession.Builder("https://warehouses.com/products/1");
GenericRequestSession session;

try {
    session = builder.build();
} catch (BuilderException e) {
    // Handle errors
}
````

2. Send a request providing the class of the response. 

````
if(session != null) {
    try {
        Product product = session.sendRequest(Product.class);
    } catch (ResponseException e) {
        // Handle errors
    }
}
````

To get multiple objects we need to provide an array class. This will return an array of products

````
if(session != null) {
    try {
        Product[] products = session.sendRequest(Product[].class);
    } catch (ResponseException e) {
        // Handle errors
    }
}
````
 
You can also get a list using the _sendRequestExpectingList_ method instead.

````
List<Product> products = session.sendRequestExpectingList(Product[].class);
````

#### POST request

1. Built a session with Builder class.

````
GenericRequestSession.Builder builder = new GenericRequestSession.Builder("https://warehouses.com/products");

builder.withMethod(RequestMethod.POST)
.withOutput(true)
.withResponseCode(201);

GenericRequestSession session;

try {
    session = builder.build();
} catch (BuilderException e) {
    // Handle errors
}
````

2. Send a request providing the class of the response and request body. 

````
if(session != null) {
    try {
        CustomPostResponse response = session.sendRequestWithBody(CustomPostResponse.class, product);
    } catch (ResponseException e) {
        // Handle errors
    }
}
````

_sendRequestWithBody_ supports 3 types of body input:

1. Custom Object

````
CustomPostResponse response = session.sendRequestWithBody(CustomPostResponse.class, product);
````

2. Gson's JsonObject 

````
CustomPostResponse response = session.sendRequestWithBody(CustomPostResponse.class, jsonObject);
````

3. Json formatted string

````
CustomPostResponse response = session.sendRequestWithBody(CustomPostResponse.class, "{\"name\":\"salad\",\"price\":22}");
````

### Handling exceptions

When you send a request things can go wrong, and you need to see the output generated by the server.

Those errors are in the ResponseException object.

````
catch (ResponseException exception) {
    System.out.println(exception.getServerErrors()); 
}
````

Since the errors depend on the use case the _getServerErrors_ getter returns an JsonObject instance.

````
catch (ResponseException exception) {
    JsonObject errors = exception.getServerErrors();
    
    System.out.println(errors.get("message").getAsString());
}
````

## Running the tests

Included test uses the [Java-Spring-API](https://github.com/dnieln7/Java-Spring-API/tree/1.0) project.